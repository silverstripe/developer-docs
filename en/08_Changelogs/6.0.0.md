---
title: 6.0.0 (unreleased)
---

# 6.0.0 (unreleased)

## Overview

- [Features and enhancements](#features-and-enhancements)
  - [Run `CanonicalURLMiddleware` in all environments by default](#url-middleware)
  - [Changes to default cache adapters](#caching)
  - [Changes to scaffolded form fields](#scaffolded-fields)
  - [Other new features](#other-new-features)
- [Bug fixes](#bug-fixes)
- [API changes](#api-changes)
  - [Most extension hook methods are now protected](#hooks-protected)
  - [Strict typing for `Factory` implementations](#factory-strict-typing)
  - [General changes](#api-general)

## Features and enhancements

### Run `CanonicalURLMiddleware` in all environments by default {#url-middleware}

In Silverstripe CMS 5 [`CanonicalURLMiddleware`](api:SilverStripe\Control\Middleware\CanonicalURLMiddleware) only runs in production by default. This lead to issues with `fetch` and APIs behaving differently in production environments to development. Silverstripe 6.0 changes this default to run the rules in `dev`, `test`, and `live` by default.

To opt out of this change include the following in your `_config.php`

```php
use SilverStripe\Control\Middleware\CanonicalURLMiddleware;
use SilverStripe\Core\CoreKernel;

CanonicalURLMiddleware::singleton()->setEnabledEnvs([
    CoreKernel::LIVE,
]);
```

### Changes to default cache adapters {#caching}

The [`DefaultCacheFactory`](api:SilverStripe\Core\Cache\DefaultCacheFactory) used to use APCu cache by default for your webserver - but we found this cache isn't actually shared with CLI. This means flushing cache from the CLI didn't actually flush the cache your webserver was using.

What's more, the `PHPFilesAdapter` used as a fallback wasn't enabled for CLI, which resulted in having a different filesystem cache for CLI than is used for the webserver.

We've made the following changes to resolve this problem:

- The `PHPFilesAdapter` will only be used if it's available for both the webserver *and* CLI. Otherwise, `FilesystemAdapter` will be used for both.
- There is no default in-memory cache used by `DefaultCacheFactory`.
- Cache factories have been implemented for Redis, Memcached, and APCu, with a new [`InMemoryCacheFactory`](api:SilverStripe\Core\Cache\InMemoryCacheFactory) interface available for your own implementations.

We strongly encourage you to configure an appropriate in-memory cache for your use-case. See [adding an in-memory cache adapter](/developer_guides/performance/caching/#adapters) for details.

### Changes to scaffolded form fields {#scaffolded-fields}

Some of the form fields have changed when scaffolding form fields for relations.

Previously, `File`, `Image`, and `Folder` were all scaffolded using `UploadField` for `has_one` relations, and `GridField` for `has_many` and `many_many` relations.

All other models used `SearchableDropdownField` for `has_one` relations and `GridField` for `has_many` and `many_many` relations.

|Class|`has_one`|`has_many`|`many_many`|
|---|---|---|---|
|[`SiteTree`](api:SilverStripe\CMS\Model\SiteTree)|[`TreeDropdownField`](api:SilverStripe\Forms\TreeDropdownField)|[`TreeMultiselectField`](api:SilverStripe\Forms\TreeMultiselectField)|[`TreeMultiselectField`](api:SilverStripe\Forms\TreeMultiselectField)|
|[`Group`](api:SilverStripe\Security\Group)|[`TreeDropdownField`](api:SilverStripe\Forms\TreeDropdownField)|[`TreeMultiselectField`](api:SilverStripe\Forms\TreeMultiselectField)|[`TreeMultiselectField`](api:SilverStripe\Forms\TreeMultiselectField)|
|[`Member`](api:SilverStripe\Security\Member)|No change|[`SearchableMultiDropdownField`](api:SilverStripe\Forms\SearchableMultiDropdownField)|[`SearchableMultiDropdownField`](api:SilverStripe\Forms\SearchableMultiDropdownField)|
|[`File`](api:SilverStripe\Assets\File)|No change|[`UploadField`](api:SilverStripe\AssetAdmin\Forms\UploadField)|[`UploadField`](api:SilverStripe\AssetAdmin\Forms\UploadField)|
|[`Image`](api:SilverStripe\Assets\Image)|No change|[`UploadField`](api:SilverStripe\AssetAdmin\Forms\UploadField)|[`UploadField`](api:SilverStripe\AssetAdmin\Forms\UploadField)|
|[`Folder`](api:SilverStripe\Assets\Folder)|[`TreeDropdownField`](api:SilverStripe\Forms\TreeDropdownField)|[`TreeMultiselectField`](api:SilverStripe\Forms\TreeMultiselectField)|[`TreeMultiselectField`](api:SilverStripe\Forms\TreeMultiselectField)|
|[`TaxonomyTerm`](api:SilverStripe\Taxonomy)|No change|[`SearchableMultiDropdownField`](api:SilverStripe\Forms\SearchableMultiDropdownField)|[`SearchableMultiDropdownField`](api:SilverStripe\Forms\SearchableMultiDropdownField)|
|[`Link`](api:SilverStripe\LinkField\Models\Link)|[`LinkField`](api:SilverStripe\LinkField\Form\LinkField)|[`MultiLinkField`](api:SilverStripe\LinkField\Form\MultiLinkField)|No change|
|[`BlogCategory`](api:SilverStripe\Blog\Model\BlogCategory)|No change|[`TagField`](api:SilverStripe\TagField\TagField)|[`TagField`](api:SilverStripe\TagField\TagField)|
|[`BlogTag`](api:SilverStripe\Blog\Model\BlogTag)|No change|[`TagField`](api:SilverStripe\TagField\TagField)|[`TagField`](api:SilverStripe\TagField\TagField)|

### Other new features

- Native indexed PHP arrays can now be passed into templates and iterated over with `<% loop $MyArray %>`. Under the hood they are wrapped in [`ArrayList`](api:SilverStripe\View\ViewableData), so you can get the count using `$Count` and use `<% if $ArrayList %>` as a shortcut for `<% if $ArrayList.Count %>`. Other functionality from `ArrayList` such as filtering and sorting cannot be used on arrays since they don't have keys to filter or sort against.
- Modules no longer need to have a root level `_config.php` or `_config` directory to be recognised as a Silverstripe CMS module. They will now be recognised as a module if they have a `composer.json` file with a `type` of `silverstripe-vendormodule` or `silverstripe-theme`.

## Bug fixes

This release includes a number of bug fixes to improve a broad range of areas. Check the change logs for full details of these fixes split by module. Thank you to the community members that helped contribute these fixes as part of the release!

## API changes

### Most extension hook methods are now protected {#hooks-protected}

Core implementations of most extension hooks such as `updateCMSFields()` now have protected visibility. Formally they had public visibility which meant they could be called directly which was not how they were intended to be used. Extension hook implementations are still able to be declared public in project code, though it is recommended that all extension hook methods are declared protected in project code to follow best practice.

### Strict typing for `Factory` implementations {#factory-strict-typing}

The [`Factory::create()`](api:SilverStripe\Core\Injector\Factory::create()) method now has strict typehinting. The first argument must be a string, and either `null` or an object must be returned.

One consequence of this is that you can no longer directly pass an instantiated anonymous class object into [`Injector::load()`](SilverStripe\Core\Injector\Injector::load()). Instead, you need to get the class name using [`get_class()`](https://www.php.net/manual/en/function.get-class.php) and pass that in as the class.

```php
use App\ClassToReplace;
use SilverStripe\Core\Injector\Injector;

// Use `get_class()` to get the class name for your anonymous class
$replacementClass = get_class(new class () {
    private string $property;

    public function __construct(string $value = null)
    {
        $this->property = $value;
    }
});

Injector::inst()->load([
    ClassToReplace::class => [
        'class' => $replacementClass,
    ],
]);
```

### General changes {#api-general}

- [`DataObject::write()`](api:SilverStripe\ORM\DataObject::write()) has a new boolean `$skipValidation` parameter. This can be useful for scenarios where you want to automatically create a new record with no data initially without restricting how developers can set up their validation rules.
- [`FieldList`](api:SilverStripe\Forms\FieldList) is now strongly typed. Methods that previously allowed any iterable variables to be passed, namely [`FieldList::addFieldsToTab()`](api:SilverStripe\Forms\FieldList::addFieldsToTab()) and [`FieldList::removeFieldsFromTab()`](api:SilverStripe\Forms\FieldList::removeFieldsFromTab()), now require an array to be passed instead.
- [`BaseElement::getDescription()`](api:DNADesign\Elemental\Models\BaseElement::getDescription()) has been removed. If you had implemented this method in your custom elemental blocks, either set the [`description`](api:DNADesign\Elemental\Models\BaseElement->description) configuration property or override the [`getTypeNice()`](api:DNADesign\Elemental\Models\BaseElement::getTypeNice()) method.

<!--- Changes below this line will be automatically regenerated -->

<!--- Changes above this line will be automatically regenerated -->
